#!/usr/bin/python

import sys

#for testing
Sbox = [[2610398182035816448, 3460921702789406720, 3506948562549055488, 2658144720519053312, 2095682431813989888, 4312587398931951616, 1942776114637589504, 3141653364259571200, 650937430442101248, 2586120031950864896, 2706547469972711936, 3741015709033234432, 3815718264671650304, 2404483626934746112, 28071624700637696, 3005432487371822592, 813532531074291712, 3346987995442099712, 927403770026934784, 2404744210123825664, 1366875987431019008, 2551891890075883520, 692613602104593920, 828764637969561600, 4064860348150801920, 1767741548783608832, 1780978178180566528, 222567460175086592, 4560944266458301440, 761670514817820160, 2470402325763282944], [4453891143837759488, 2309204152023341568, 4091683011766704128, 2178441687890139648, 2966380169193952768, 7661841619964928, 3038336578408699392, 2066259770475421696, 914320036370822144, 1408428270345595904, 1041709844109816832, 2525903336901586432, 1362524350688594944, 2296510027146732544, 637705476187102720, 551718055435534336, 3541079979948999168, 2683217370288560640, 2350210241039328768, 123688276832308224, 3813305574900746752, 2310237159992452096, 1382716417180064768, 3372068887535726592, 1862269574016613376, 460346686287941632, 4191596980213569024, 1008776285662683648, 475993134178678784, 951193777161994240, 2899056081213777408], [122338756610320384, 1384615752603243008, 2861836157541002752, 3348341087653601280, 3186536641019231744, 754044104980705280, 291424630205040128, 2609110636296125952, 3519437536231575040, 2345910514861315072, 4082720355697377792, 1196654467738897408, 330011649824919552, 2123123235207909888, 3193190925833618944, 3848417082216214016, 3669657343048438784, 3840709694493239296, 588468487355150848, 2296666652873945088, 1886146952670243840, 2599568290874467840, 1911056665069632512, 996772449503697408, 3251080946807593472, 2401529345470788096, 1395128277968045568, 3611405604093215232, 1313465403832992256, 3872439029677725696, 4208624884054234624], [325043707477737472, 2526233171981227520, 4228038239484519936, 3564375431033672704, 4010374880214607360, 4589534092935896064, 3947507114835472384, 3808858249065766400, 2934536042805526016, 3369462292378387968, 4017888525170180608, 4493592747573089792, 3602634580952897536, 1780940143133575680, 4062302317784108544, 2564484254896764416, 1434883655236700160, 820641510145214976, 2711021538588033536, 4016832556948322816, 871762016261372416, 1110219608528035328, 2372416707991723520, 2268766203072702976, 2616514029711850496, 136962163868848128, 1784432912589982720, 4595488816077825536, 908253215750859776, 3301464715395738112, 903447877172854784], [4570896090268207616, 3339991533628198400, 3526735221784367616, 447862557850499072, 2512193439239240704, 4321492803389095424, 2881849590817315840, 947941708150596608, 2427789427893615104, 482077352400195072, 3962170312646310400, 1160735065202142720, 266014329748785664, 1863723813834701824, 3711757913925783040, 373401645866296832, 2178407153564458496, 4447931349197770752, 3037818455795186688, 4081141245336550400, 4395704063288305152, 1696212837148140544, 4534880854539269632, 687549888713869312, 4420742086330832896, 89624009873756160, 2323795802162812416, 3701732183345994752, 490161141975761408, 3702006329764907520, 2011923948503722496], [2822270952550611456, 2722140820515685888, 3419192173437287424, 4133416736037717504, 686912321762291200, 4519174503623598080, 4532866973383626240, 3901977849210082304, 554383120001938432, 1858150035302781440, 4364547241159883264, 43519379163635200, 3135264932047510528, 3956501887818163200, 739410946425302016, 3660625053017277440, 686309163713597952, 3384151760728652800, 4370079414401473536, 2341870436478602240, 1155895754210545152, 1132984871251422208, 2086680708624881664, 269512426236705280, 2242214870100043776, 4422092679072083456, 3732141152682629120, 2982348932720078848, 1936265713555723776, 338903069880372736, 831910589520599040], [1105532226556445184, 4405645339019257344, 4467399932768740864, 767015627015424000, 192177395488543744, 1301693709769697792, 2134598014717326336, 1943165540234385408, 2592052070765539840, 2908598428621728768, 4028491233556631552, 1711605778789505024, 2772777344218951680, 411910753121593344, 2207684867351686144, 2626372986427364864, 4240075640940449792, 4494789570975297536, 660037293108721152, 3917709038666015744, 2351926688886472192, 69871921826793984, 1029924144544436224, 1668863278653152256, 80469704846417920, 3768932200149548544, 1585133268327577600, 4334145949872152576, 2908366258747205120, 2196080315916870656, 1547012409090191360], [205572634600010240, 150033375005820416, 889111823507489280, 286048743997483520, 2850575109890051072, 3622483640200459776, 201688264866205184, 721598827004030976, 2595410895915655168, 2343603503204495360, 4397353222058829312, 553702567689717248, 1574068240823769088, 4099415528276904448, 2536665279387007488, 1951045144453308928, 2376263032556013056, 3767652582414410752, 2470743684454767104, 1960361841017691648, 2595910094939701760, 228420442287688704, 2144175525864953344, 3957665192326152704, 3540476943277589504, 3829540189727071744, 3269996944346778624, 4054089831683150848, 3275289087965758976, 928765893189792256, 1833933395027277824], [1586396586436545536, 2481787768874398720, 1715627188674903040, 3664296911561951232, 529130728652150272, 2445824995377360896, 1437170517950324736, 4394508295254881792, 2875532697182813696, 2157823926036987904, 211259455220008960, 3740249770735336960, 105285486863014912, 914274208600766976, 3043654060440302080, 1481732359152651264, 2677393524282764800, 1783824188514112512, 4502478216199460864, 3065668017981306368, 4268224383987153408, 1876950718484327424, 1406453390872207872, 2322097453872378368, 739659392739705344, 180899346949156864, 2599370719738792448, 2572463023755082752, 1576983283881546752, 4604432102283639296, 3962079569525023232], [4510385942421174272, 2770530219741405696, 2155331286249813504, 2970746570965716480, 2787414626410253824, 1095869362317152768, 2750928047005350912, 2893621622420012032, 1415091554025054208, 92564582593792512, 3874263166889371648, 2367605458453581312, 3144590960693784064, 36697535071010816, 4568464571760364544, 2375057436186939392, 683334034556241920, 2560765909047952896, 352272152919299072, 4360211851129537536, 2451656810533542400, 2045330170261862912, 3238534514084315648, 2982800160917735936, 3018700511095566336, 4192014060231352832, 3448957763636494336, 4014313750097382912, 3870676737154177024, 734152051726733824, 2158870134550464000], [3465210541466472448, 4506340632772400128, 1590408626948018688, 2276384167652655104, 59397454270067712, 1777834881065667072, 4452074756456744960, 558616651428752384, 4180769773420497920, 1205402053727960064, 4315508394784149504, 3992643763682225152, 3485325572337652224, 1491457266590057984, 3733429595696878592, 3431928999400027136, 1765389387095991808, 58716188742697984, 2192153966657369600, 3945896058472449024, 5045416028798976, 2842445778851146240, 1595842782334920192, 1887933731705633280, 2091568882666388480, 1104646786472189440, 297445499105256960, 2982576371245072896, 3532827212862319104, 3743287571793149952, 3241282105141223936], [3341359110130740736, 4041207267697104896, 3438719660477066240, 1575747935573797376, 3012526428102181376, 3308501644721559552, 1973816058200217088, 1530727332561946624, 2375256518826324480, 2845216084253829120, 4269207036240147968, 4299547561398985216, 3199144603601629184, 1454025352998114304, 3671422639493079552, 1477194358195667968, 1243857706887090176, 3727574273271628800, 2551064009829248000, 1332273992796134400, 1157158881173547008, 819785123197237248, 4435850694643809280, 1141757604195321856, 258255564963769856, 3960957666302193152, 2752150077082895872, 762113879840593920, 230797841709463552, 3111057669152427520, 3913530071429669376], [1085843750900419072, 92527463215809536, 3178537800662405632, 2477682414647916032, 1776657023935666688, 2702936610041501184, 4431089777281620480, 629242266642079744, 1004742003170493952, 942862466830968832, 3645987850088704512, 1115588868030760448, 593274035594275328, 524503331027416064, 1911639081973527040, 2174088371226123776, 3311432435804337152, 2547545024306113024, 188534721277689856, 4209500866673276416, 1307549448819126272, 1040127585703066624, 2652784030888498176, 2770898804523463168, 4366444874347547648, 604676405792152576, 2910682331684761088, 145128225530529792, 4450744639670776832, 163219614634571776, 770739207664524800], [749228767189399040, 91245454276104192, 1773460910188860416, 4388206204902306304, 791847745635490304, 3130005031741818368, 4241959448211752448, 3591672863250669568, 4435813811820895744, 1062342388654877696, 2509469412487776256, 2258745572721323520, 4560087493293329408, 2429567000788203008, 1452901325973218304, 1227928438245590016, 4170109216053854208, 4180711601879059456, 2033451841064603648, 3443959853233008128, 193880958868474880, 660147051797757952, 2262531673043451904, 2965325723799153664, 3670485568730742272, 3892656571752038912, 1532473332247066624, 2464818173395744256, 2343113002588429824, 4372340492021660672, 1904246861665417216], [3581501279711842816, 2789390315970906624, 2249873474681576448, 1218563789803443712, 2360850307374669824, 4325455979202530304, 3189838788788320256, 2798719451205541888, 4498107820213684736, 1671537011226535424, 2145443324143300096, 1982643647715202560, 3621257303055993344, 1664590724199052288, 3440874104976799744, 212401716152308736, 186673573511939072, 1198352949178027520, 76250091540807680, 4050077325380191744, 3752352991045999104, 4062240944441376768, 3592573529504738816, 1442077564716601856, 1995494876217155584, 2809633121356190720, 6372809435399680, 4428456598978882560, 4254599356941297152, 956296193952761856, 3194998441901105664], [1987592641284813824, 4305804780382546944, 4142193896479985664, 4605444770278637056, 1254528155766020096, 4397290427419566592, 2221567459498433536, 2337160433757716992, 3650973967989641216, 1673165945662915584, 3730218173375256064, 578733070525421056, 1348066494405874176, 3411050248930000896, 2355305131186068992, 3236243559071912960, 1586615562911420416, 4549921015971369472, 3508468573994996224, 4426080799999023616, 3619433783004245504, 1065449255782609920, 2696519843634297344, 97637303452078592, 605770812978748416, 4544850759190260224, 2540367202013646336, 1820780376645703680, 4071388685726467584, 1507926127990287872, 4503774329652395520], [3662670885224184320, 1608985299920190464, 2513022184829602816, 202905146923796992, 2952781427885012480, 2285117895002062336, 1950573658115163136, 3420258585314887168, 4359015481679032320, 28194344044147200, 1903775868467928064, 1642337380747360256, 3704817852577198080, 4370638957207443968, 3258404215620008448, 1352243913407587840, 2600224628730607616, 4576830900921160192, 1251000510496060416, 2028321037832143872, 3719755407924698624, 3160254293810657792, 1683487047517953024, 1996051816572868608, 2758558499727608832, 3530172795318274048, 2355125040234332160, 2220164033232923136, 3989487215168190976, 2934164115471940096, 1365232181166319104], [3298749174380453376, 123344433307055104, 2044869760487875072, 2101311378193104384, 3409288804727318016, 122932961369495040, 1099463922645299712, 955016182878124032, 4056878866158522368, 3376397759629121536, 4481010821610380288, 510762676905162240, 3985080007661832192, 2843206254289256448, 3389648479601456640, 453612059005038592, 1628677920903588352, 185430175277241856, 1694530217146968064, 3477231622283720704, 1963141288427385856, 4554132138693737472, 3894906229321365504, 1036922826107769856, 2350950896806771200, 3270769080591377408, 1847446242201967104, 2850557302475553792, 574677204824347648, 1896133161307453952, 3554404170983929344], [124257017947607040, 465581936265203200, 1909926294487796224, 1150363423135828992, 2532749753897763328, 3208796530076086784, 1869037537261644288, 3376853394814154752, 428835653734732800, 3730835147478455296, 195408616323000832, 1022628035785890816, 3105974254514886144, 2836779653951059968, 1930324568529324544, 1674878032630680064, 387451163241134592, 3243092153318432256, 4316170725033526272, 2151591454633533952, 2681012024224285184, 2254686920199390720, 1036092228169486848, 3190618745623032832, 4423794886032056320, 4542826731315835392, 2275994382320678912, 3724668127564178944, 2108277950634829312, 4519900766946713088, 2551940789238519296], [21993204130971136, 556450987130779648, 1987558337356926976, 2986096746920807936, 2354958102250556416, 2584947014406358528, 1986433475688394752, 2867316876282985984, 1851032515739826176, 1532783674527817728, 1409661333295857152, 2275453689936066560, 2657964116509145088, 819669341377590784, 1825757421781779968, 4053562677409680896, 1689106989937377792, 3134704276474869760, 3229696302142477824, 2947126971731783680, 4035070310813049856, 1316113920874386432, 3318194387829804544, 3152941821765626368, 2329440422131398144, 1447888811465282048, 3486393124226169856, 1837441130670411264, 806886815143079424, 3364604373812063744, 989244982539510272], [3389979261589018112, 3715722026914402816, 3165437832641252352, 295578045771789312, 656735011683736064, 854090855283459584, 4521631271438611456, 844115629449014272, 3149432562616013824, 251842155264512000, 1612907407914178048, 1924629137351356928, 652676908649511424, 3803057171332990976, 923981732617728512, 4115825321200146432, 97064464286019584, 2907674713916690944, 3759275765674916352, 3648204872610882048, 4549821929749612032, 1098033189410917888, 507132119483243520, 1772117772689744896, 2686938367699748352, 1573805668078174720, 895035640969832960, 4088471645019268096, 3959010065591563264, 1621026888835261440, 2304155620765236224], [406941127880194048, 2540810777799505920, 1604321751369409536, 4065403600055872512, 299764308489604608, 480814186735430656, 4367809023349523968, 4600076666306167808, 2477912986785737216, 2738055440631435264, 4230051361428499456, 3839233298438594048, 1085955916530406400, 1671784170904520704, 1801816319226177536, 4544804573267756544, 942195107668633088, 527293022332078592, 1164468201894565376, 2740931470693991936, 1525921522043833344, 3333400194753025536, 4349862745190006272, 2234845556921570816, 2320691473497890304, 4343419737171083776, 3802594678050649088, 4592400987965770752, 2640238548005458432, 1221353445991908352, 3528068454755326976], [196786803168302080, 3729215940540973056, 979057258063766528, 1296040895943050752, 4591008929858502144, 284080464991827968, 1967114357908150784, 3853718469543447552, 1917492388228529664, 1083683542111510528, 181855400286111232, 1327208081096616960, 1294320078457428480, 287937936397504512, 1969296761630900224, 1302337976509997056, 60326082455888896, 112629495862511616, 1601775307180421120, 4144616826399460864, 1665898648558959104, 3766489188714374144, 663366280782641152, 3798155715774857216, 286052206230055936, 3715761213941791744, 3023615764534294016, 2182172774334950400, 1116760296849748480, 3914267224388385280, 1626472794083374080], [2408994736968034816, 3392469358288175616, 196636613773861376, 4253156316327503872, 761382669965575168, 2505572070567824896, 3652598081763496448, 2242017373886590464, 4307273293981557248, 194411985819518976, 1781322047096760320, 2840486117506899968, 2827159360329729536, 1049625071343559680, 4278942785848309760, 647184851904386560, 1882357410636814848, 4097267229935256064, 3440994254216518144, 1934776768523433472, 2845756242959677952, 317327616078505472, 3663925933580268544, 2601450001839420416, 788148181135437824, 4207641408117395456, 2684790361725946368, 1073174863928346112, 2804542758604066304, 2089874300248842752, 2136951931615900160], [74368725552913920, 2424575794467101696, 2203943880882263552, 1547411580699502592, 1175615066138858496, 264013613847949312, 921058513854150144, 3529556582494376960, 736781292134284288, 4495686829143074304, 88312559756387840, 2453322051274587648, 3011244583251559936, 3397747178441688576, 3975230564249875456, 3561450587435840000, 4357775710152422912, 2452086417686625280, 913512957278074368, 1973899766536022016, 2553986490934829568, 4542585789125085696, 4494951441360326144, 4015065279165086208, 118486868751243776, 4387171362901583872, 1766210276317398016, 4527636125658030080, 4514240249215130624, 2428401752565361664, 72732613296172544], [3321753167583018496, 743005339917022208, 2448123937290554880, 3109552015967887360, 4207002256857019392, 3006106313561159680, 3972317737021058560, 3447272918638329856, 758357586623675904, 736942092401306624, 3777088452013979136, 2979667974401106432, 1241099233792123392, 1324376967369842176, 3531422280639389184, 4005022125985642496, 163596694655894016, 1909889649440921600, 4019341325144357888, 2740657786190937600, 2182915549115644416, 1354800320108316672, 228231948136820224, 4203618108026069504, 1598684210097951232, 4158415270103794176, 3833333673121721344, 1133448565673516544, 2652361595309024256, 1500040665519452160, 3129320706781915136], [4364890617737416704, 3768556448548730880, 4454460638550988800, 2176853507248146944, 2491917981440354816, 3251038484833774592, 1669771548160061952, 3484032965858050048, 1249018026016389120, 2841688571087087104, 117903040504269824, 4423697670044333056, 3217550782475663872, 1854098705429886464, 303750435252867072, 3651626074084392448, 1535376430608648704, 1350474909559792128, 3191163950426577408, 1867244324087606272, 1167241675892439040, 2272176426205834240, 4586072813502688256, 2627774896717177856, 1001432939908731904, 1918846777815124480, 4304221274824680960, 3244345561535876096, 2865979067142547456, 2860415142021081600, 3822932032771843072], [1672582869606919680, 3968566447044280320, 3784884610712733696, 270119363989210624, 1222052608013170176, 1120201157769088000, 3910135363103244800, 343434761695963648, 743638678940349440, 1797418088242713088, 3308806606188519936, 4292863076868711936, 4214627217801480704, 1620094025206563328, 3404747395413837824, 1560370220701837312, 4290975525246089216, 892735832660012032, 683845085625245184, 3426755951858542080, 3519002860912626688, 1275358607514922496, 4093858097511391232, 927025289392913920, 1690787938107375616, 4065133919821427200, 3495892581025695232, 3777345057493075968, 2839259382107702272, 4034123341147150336, 2156150465591936512], [1474896666718235136, 3245430039880188416, 3156270022491222528, 1543582044717645824, 1092352699107953664, 1107049223266670592, 1512974213698530816, 704729476158683648, 1391274458323099648, 4236121491802813440, 3625271852798131712, 4136342947011244032, 2662424437195776000, 2663887434411378688, 4016279829392026112, 1944729072687778304, 1741081390907504128, 1893782617887138816, 1170902087983990272, 3999661410102254592, 719483548601649664, 3252021224752738304, 3948919649501592064, 3206829691627392000, 4290025378063245824, 2919525361303560704, 3048632940393480704, 56811882463104512, 3584960742131687424, 3237912174025141248, 3482542184301356544], [2842488581931044352, 3647100610434739200, 4419253420114744832, 1752797416401169920, 1814664801163307008, 1739191935805150720, 2336074916791244800, 844481707564656640, 1238153743296436224, 2583784022156191232, 615475653523618304, 838204471510103040, 2913378040872764928, 4435995597013392384, 3160954087606038016, 2269277340329861120, 3325501293422529024, 800471106892635136, 3944529511132757504, 1763948013643478528, 2383233429726488576, 2811315236253539840, 2158029795265434112, 419459130530409984, 4365550522877093376, 736167871601460736, 2670896192248378368, 89881430017637888, 3088634515607548928, 1802537408754047488, 59493555393442816], [898398632754047488, 1136788505628757504, 772260896066166272, 3222226648164986880, 1406898643983434240, 3206294159525614592, 546806499762292736, 2005721097198198272, 2716453872645848064, 3102295797752911360, 3005718712638333440, 1040720007755820544, 938258074458471424, 2336433995910313472, 3348722762774323712, 1665361267620247552, 3411926811104558592, 3209449160528250368, 3155524851193468928, 1504233404711721984, 4085818491440900608, 3048879648615688192, 2535308542135638016, 1390147587857190912, 1519593445363977216, 2344187747147555840, 4486274765584581120, 1576466986851250688, 3499931062036640768, 2598073881430087680, 4122033294662182400]]
def splitPlainToBlocks(plain, blockSize):
	"""Split the plaintext into blocks"""
	charblocks = []
	for i in xrange(0,len(plain),blockSize):
		charblocks.append(plain[i:i+blockSize])
	if len(plain) % blockSize != 0:
		charblocks[-1] += plain[0:blockSize -len(charblocks[-1])]
	
	blocks = []	#blocks is a 2d array
	
	for i in xrange(len(charblocks)):
		blocks.append([])
		s = charblocks[i]
		for c in s:
			blocks[i].append(ord(c))
	
	return blocks

def parity(block):
	"""return the parity as an int"""
	#reduce block to 8 bits
	runTot = block[0]
	for i in xrange(1,len(block)):
		runTot = runTot ^ block[i]
	
	#reduce runTot to 4 bits
	firstHalf = runTot >> 4
	secondHalf = runTot % 16
	runTot = firstHalf ^ secondHalf
	
	#2 bits
	firstHalf = runTot >> 2
	secondHalf = runTot % 4
	runTot = runTot = firstHalf ^ secondHalf
	
	#parity bit
	firstHalf = runTot >> 1
	secondHalf = runTot % 2
	return firstHalf ^ secondHalf



def keylessHash(plainText):
	"""Driver function for hashing"""
	blocks = splitPlainToBlocks(plainText, 2)
	
	#print blocks
	
	#build parity string z
	z = ""
	for block in blocks:
		z += str(parity(block))
	
	#add leading zeros
	while len(z) < 8:
		z = "0" + z
	
	splitSpot = (len(z) / 4)# % len(Sbox)
	
	#get indexes for Sbox
	i = int(z[:splitSpot],2)
	j = int(z[splitSpot:],2)
	
	print "Input:",len(plainText) * 8,"bits"
	return Sbox[i%len(Sbox)][j%len(Sbox[0])]# % (pow(2,len(plainText)))
	
	

arg = ""
for i in xrange(1,len(sys.argv)):
	arg += sys.argv[i]

hashed = keylessHash(arg)
print "Decimal:\t",hashed
print "Binary:\t\t",bin(hashed)[2:]
print "Hex:\t\t",hex(hashed)
